<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>Chow Sim iOS 26 - Ultimate Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        ::-webkit-scrollbar { display: none; }
        body {
            background-color: #000;
            color: #fff;
            overscroll-behavior: none;
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            padding-bottom: env(safe-area-inset-bottom);
        }
        input { -webkit-user-select: text; user-select: text; outline: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .glass-dark { background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .ios-shadow { box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.7); }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-float { animation: float 4s infinite ease-in-out; }
        .stat-bar { height: 6px; border-radius: 3px; background: rgba(255,255,255,0.1); overflow: hidden; }
        .stat-fill { height: 100%; transition: width 0.5s ease; }
        .app-icon-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; padding: 1rem; }
        .app-icon { width: 100%; aspect-ratio: 1; border-radius: 1.25rem; display: flex; items-center; justify-center; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useRef, useMemo } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import htm from 'https://esm.sh/htm';
        import * as Lucide from 'https://esm.sh/lucide-react@0.263.1';
        import { GoogleGenAI } from "https://esm.sh/@google/genai@1.40.0";

        const html = htm.bind(React.createElement);

        // --- EXPANDED GAME DATA ---

        const THEME_COLORS = {
            copper: '#b87333', silver: '#c0c0c0', gold: '#ffd700', platinum: '#e5e4e2',
            emerald: '#50c878', ruby: '#e0115f', sapphire: '#0f52ba', amethyst: '#9966cc',
            diamond: '#b9f2ff', obsidian: '#282828', rainbow: 'linear-gradient(45deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3)'
        };

        const IPHONES = Array.from({ length: 21 }, (_, i) => ({
            id: `ip-${i}`,
            name: i === 0 ? "iPhone Original" : `iPhone ${i + 1} Pro Max`,
            price: Math.floor(150 * (i + 1) * (1 + i * 0.28)),
            brand: 'Apple'
        }));

        const SAMSUNGS = Array.from({ length: 10 }, (_, i) => ({
            id: `ss-${i}`,
            name: `Samsung Galaxy S${21 + i} Ultra`,
            price: 600 + (i * 480),
            brand: 'Samsung'
        }));

        const CARS = Array.from({ length: 21 }, (_, i) => {
            const carNames = ["Bicycle", "Skateboard", "Rusty Sedan", "Old Vespa", "VW Golf", "Honda Civic", "BMW M3", "Tesla Model 3", "Audi RS6", "Porsche 911", "Mercedes G63", "Nissan GT-R", "Lambo Huracan", "Ferrari SF90", "McLaren P1", "Aston Martin DB11", "Rolls Royce", "Bugatti Chiron", "Koenigsegg Jesko", "Private Jet", "SpaceX Starship"];
            const colors = ["#444", "#222", "#8B4513", "#fbbf24", "#3b82f6", "#fff", "#111", "#fff", "#444", "#facc15", "#000", "#fff", "#fb7185", "#dc2626", "#ea580c", "#1e293b", "#000", "#1e40af", "#fff", "#fff", "#ccc"];
            return {
                id: `car-${i}`,
                name: carNames[i] || `Supercar V${i}`,
                price: i === 0 ? 100 : Math.floor(500 * Math.pow(2.1, i)),
                color: colors[i] || "#444"
            };
        });

        const HOUSES = Array.from({ length: 21 }, (_, i) => ({
            id: `h-${i}`,
            name: i === 0 ? "Parents' Sofa" : i < 5 ? `City Studio ${i}` : i < 15 ? `Suburban Villa ${i - 4}` : `Mega Mansion Level ${i - 14}`,
            price: i === 0 ? 0 : Math.floor(25000 * Math.pow(2.0, i)),
            rent: i === 0 ? 0 : Math.floor(200 * Math.pow(1.5, i))
        }));

        const CHAINS = Object.entries(THEME_COLORS).map(([name, color]) => ({
            id: `chain-${name}`, name: `${name.charAt(0).toUpperCase() + name.slice(1)} Chain`, color, price: 5000
        }));

        const RINGS = Object.entries(THEME_COLORS).map(([name, color]) => ({
            id: `ring-${name}`, name: `${name.charAt(0).toUpperCase() + name.slice(1)} Ring`, color, price: 2500
        }));

        const SUBJECTS = ['Mathematics', 'Quantum Physics', 'Genetic Biology', 'Organic Chemistry', 'Fine Arts', 'Music Composition', 'World History', 'Political Geography', 'Computer Science', 'Business Ethics', 'Philosophy', 'Space Law'];

        const INITIAL_STATE = {
            hasStarted: false,
            name: "New Player",
            gender: 'male',
            money: 500,
            age: 10,
            week: 1,
            health: 100,
            happiness: 100,
            isDead: false,
            education: {
                primary: 0, secondary: 0,
                subjects: SUBJECTS.reduce((acc, s) => ({ ...acc, [s]: 0 }), {})
            },
            assets: { house: HOUSES[0], car: null, chain: null, ring: null, phone: null },
            social: { followers: 0, likes: 0 },
            logs: []
        };

        // --- COMPONENTS ---

        const CharacterVisual = ({ state, scale = 1 }) => {
            const { gender, assets } = state;
            return html`
                <div className="relative flex flex-col items-center justify-center py-10 transition-all duration-500" style=${{ transform: `scale(${scale})` }}>
                    ${assets.car && html`
                        <div className="absolute -z-10 opacity-30 blur-[1px] translate-y-6">
                            <svg width="240" height="120" viewBox="0 0 200 100">
                                <path d="M10 80 L35 40 L165 40 L190 80 L195 95 L5 95 Z" fill=${assets.car.color} />
                                <circle cx="45" cy="92" r="16" fill="#111" />
                                <circle cx="155" cy="92" r="16" fill="#111" />
                            </svg>
                        </div>
                    `}
                    <div className="relative z-10 animate-float">
                        <div className="w-20 h-20 bg-[#ffdbac] rounded-full relative z-30 shadow-xl overflow-hidden">
                            ${gender === 'female' ? 
                                html`<div className="absolute top-0 w-full h-10 bg-[#3e2723] rounded-t-full -mt-2" />` : 
                                html`<div className="absolute top-0 w-full h-3 bg-[#2d1a12] rounded-t-full" />`
                            }
                            <div className="flex justify-around mt-8 px-5">
                                <div className="w-2.5 h-2.5 bg-black rounded-full" />
                                <div className="w-2.5 h-2.5 bg-black rounded-full" />
                            </div>
                        </div>
                        <div className="w-5 h-4 bg-[#ffdbac] mx-auto relative z-20 -mt-1">
                            ${assets.chain && html`
                                <div className="absolute top-1 left-[-8px] right-[-8px] h-3 rounded-b-full border-b-[4px]" style=${{ borderColor: assets.chain.color }} />
                            `}
                        </div>
                        <div className="w-24 h-28 bg-zinc-50 rounded-t-3xl relative z-10 shadow-lg border-t border-white/20">
                            <div className="absolute -left-7 top-2 w-7 h-20 bg-[#ffdbac] rounded-full origin-top rotate-[22deg] flex flex-col items-center justify-end pb-2">
                                ${assets.ring && html`<div className="w-4 h-1.5 rounded-full mb-1 shadow-sm" style=${{ backgroundColor: assets.ring.color }} />`}
                            </div>
                            <div className="absolute -right-8 top-2 w-7 h-20 bg-[#ffdbac] rounded-full origin-top -rotate-[28deg] flex flex-col items-center justify-end pb-4">
                                ${assets.phone && html`
                                    <div className="w-10 h-18 bg-black rounded-xl border border-zinc-800 shadow-2xl flex items-center justify-center -rotate-12 mb-2 overflow-hidden">
                                        <div className="w-full h-full bg-blue-500/10 flex items-center justify-center">
                                            <div className="w-2 h-2 bg-zinc-800 rounded-full" />
                                        </div>
                                    </div>
                                `}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };

        const App = () => {
            const [state, setState] = useState(() => {
                const saved = localStorage.getItem('chow_sim_u_v26_final');
                return saved ? JSON.parse(saved) : INITIAL_STATE;
            });
            const [view, setView] = useState('home');
            const [shopPage, setShopPage] = useState('iphones');
            const [phoneApp, setPhoneApp] = useState(null);
            const [aiQuery, setAiQuery] = useState('');
            const [aiResponse, setAiResponse] = useState('');
            const [isAiLoading, setIsAiLoading] = useState(false);

            useEffect(() => {
                localStorage.setItem('chow_sim_u_v26_final', JSON.stringify(state));
                // Death mechanic: happiness OR heart hitting 0
                if (!state.isDead && (state.health <= 0 || state.happiness <= 0)) {
                    setState(p => ({ ...p, isDead: true }));
                }
            }, [state]);

            const log = (msg, type = 'info') => {
                setState(p => ({ ...p, logs: [{ id: Date.now(), msg, type }, ...p.logs].slice(0, 5) }));
            };

            const tick = () => {
                if (state.isDead) return;
                setState(prev => {
                    const nextWeek = prev.week + 1 > 52 ? 1 : prev.week + 1;
                    const nextAge = prev.week + 1 > 52 ? prev.age + 1 : prev.age;
                    return {
                        ...prev,
                        week: nextWeek,
                        age: nextAge,
                        money: prev.money + (prev.age >= 18 ? 350 : 60),
                        health: Math.max(0, prev.health - (prev.age > 45 ? 2 : 1)),
                        happiness: Math.max(0, prev.happiness - 1.5)
                    };
                });
            };

            const study = (type, sub = null) => {
                if (state.isDead) return;
                setState(prev => {
                    let cost = 0, hMod = 0, hpMod = 0, mMod = 0;
                    let nextEdu = { ...prev.education };
                    if (type === 'primary') {
                        if (prev.education.primary >= 60) return prev;
                        nextEdu.primary += 1;
                        mMod = 12; hpMod = 2; hMod = 2;
                    } else if (type === 'secondary') {
                        if (prev.education.primary < 60) { log("Need primary graduation first!", "error"); return prev; }
                        if (prev.education.secondary >= 60) return prev;
                        nextEdu.secondary += 1;
                        mMod = 15; hpMod = 2; hMod = 2;
                    } else if (type === 'subject') {
                        if (prev.education.secondary < 60) { log("Need high school graduation!", "error"); return prev; }
                        nextEdu.subjects[sub] = (nextEdu.subjects[sub] || 0) + 1;
                        cost = 15; hpMod = -2; hMod = -2;
                    }
                    return {
                        ...prev,
                        money: prev.money + mMod - cost,
                        health: Math.min(100, Math.max(0, prev.health + hMod)),
                        happiness: Math.min(100, Math.max(0, prev.happiness + hpMod)),
                        education: nextEdu
                    };
                });
            };

            const purchase = (cat, item) => {
                if (state.money < item.price) { log("Insufficient funds!", "error"); return; }
                setState(p => ({
                    ...p,
                    money: p.money - item.price,
                    assets: { ...p.assets, [cat]: item },
                    happiness: Math.min(100, p.happiness + 20)
                }));
                log(`Successfully acquired: ${item.name}`, "success");
            };

            const handleAi = async () => {
                if (!aiQuery || isAiLoading) return;
                setIsAiLoading(true);
                setAiResponse("Connecting to Neural Hub...");
                try {
                    const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                    const response = await ai.models.generateContent({
                        model: 'gemini-3-flash-preview',
                        contents: aiQuery,
                        config: { systemInstruction: "You are Chow AI, a virtual life assistant. Be concise and helpful." }
                    });
                    setAiResponse(response.text);
                } catch (err) { setAiResponse("Signal lost."); }
                setIsAiLoading(false);
            };

            if (state.isDead) {
                return html`
                    <div className="min-h-screen flex flex-col items-center justify-center p-12 text-center bg-gradient-to-b from-black to-red-950">
                        <${Lucide.Skull} size=${80} className="text-red-500 mb-8" />
                        <h1 className="text-7xl font-black mb-2 tracking-tighter uppercase italic">Wasted</h1>
                        <p className="text-zinc-500 font-bold mb-12 text-lg">Your biological protocol has been terminated.</p>
                        <button 
                            onClick=${() => { localStorage.removeItem('chow_sim_u_v26_final'); window.location.reload(); }}
                            className="bg-white text-black px-12 py-5 rounded-2xl font-black text-xl hover:scale-105 active:scale-95 transition-all shadow-2xl"
                        >New Life</button>
                    </div>
                `;
            }

            if (!state.hasStarted) {
                return html`
                    <div className="min-h-screen bg-black flex flex-col items-center justify-center p-8">
                        <div className="w-full max-w-sm glass p-12 rounded-[60px] text-center shadow-2xl border border-white/10">
                            <h1 className="text-6xl font-black mb-2 tracking-tighter">CHOW SIM</h1>
                            <p className="text-[11px] font-black uppercase tracking-[0.5em] text-blue-500 mb-12">iOS 26 Ultimate</p>
                            <input 
                                className="w-full bg-white/5 border border-white/10 p-6 rounded-[30px] mb-6 font-bold text-center text-lg"
                                placeholder="IDENTITY NAME" value=${state.name} onChange=${e => setState(p => ({...p, name: e.target.value}))} 
                            />
                            <div className="grid grid-cols-2 gap-4 mb-10">
                                <button className=${`p-5 rounded-2xl font-black transition-all ${state.gender === 'male' ? 'bg-white text-black' : 'bg-white/5 opacity-40'}`} onClick=${() => setState(p => ({...p, gender: 'male'}))}>MALE</button>
                                <button className=${`p-5 rounded-2xl font-black transition-all ${state.gender === 'female' ? 'bg-white text-black' : 'bg-white/5 opacity-40'}`} onClick=${() => setState(p => ({...p, gender: 'female'}))}>FEMALE</button>
                            </div>
                            <button 
                                className="w-full bg-blue-600 p-6 rounded-[30px] font-black text-xl shadow-lg active:scale-95 transition-all"
                                onClick=${() => setState(p => ({...p, hasStarted: true}))}
                            >INITIALIZE LIFE</button>
                        </div>
                    </div>
                `;
            }

            return html`
                <div className="min-h-screen flex flex-col">
                    <header className="p-7 pt-14 glass border-b border-white/5 sticky top-0 z-50">
                        <div className="flex justify-between items-end mb-6">
                            <div>
                                <h1 className="text-2xl font-black tracking-tight leading-none">${state.name}</h1>
                                <div className="text-[10px] font-black opacity-40 uppercase tracking-widest mt-1">Age ${state.age} / Week ${state.week}</div>
                            </div>
                            <div className="text-3xl font-black tabular-nums">£${state.money.toLocaleString()}</div>
                        </div>
                        <div className="grid grid-cols-2 gap-8">
                            <div className="space-y-1.5">
                                <div className="flex justify-between text-[10px] font-black uppercase tracking-widest opacity-40">
                                    <span>Heart</span><span>${state.health}%</span>
                                </div>
                                <div className="stat-bar"><div className="stat-fill bg-red-500" style=${{ width: `${state.health}%` }}></div></div>
                            </div>
                            <div className="space-y-1.5">
                                <div className="flex justify-between text-[10px] font-black uppercase tracking-widest opacity-40">
                                    <span>Joy</span><span>${state.happiness}%</span>
                                </div>
                                <div className="stat-bar"><div className="stat-fill bg-yellow-400" style=${{ width: `${state.happiness}%` }}></div></div>
                            </div>
                        </div>
                    </header>

                    <main className="flex-1 overflow-y-auto p-6 pb-44 no-scrollbar">
                        ${view === 'home' && html`
                            <div className="space-y-8">
                                <div className="glass p-12 rounded-[70px] flex flex-col items-center ios-shadow border border-white/10">
                                    <${CharacterVisual} state=${state} scale=${1.6} />
                                    <div className="mt-10 px-8 py-3 bg-white/5 rounded-full border border-white/5">
                                        <span className="text-[10px] font-black uppercase tracking-widest opacity-30 block text-center mb-1">Occupation</span>
                                        <span className="text-lg font-black">${state.age < 18 ? 'Academy Student' : 'Global Citizen'}</span>
                                    </div>
                                </div>

                                <div className="grid grid-cols-2 gap-4">
                                    <button onClick=${() => setView('darkweb')} className="glass p-8 rounded-[40px] flex flex-col items-center gap-3 active:scale-95 transition-all border border-red-500/10">
                                        <${Lucide.Skull} size=${32} className="text-red-500" />
                                        <span className="font-black text-[11px] uppercase tracking-widest">Dark Web</span>
                                    </button>
                                    <button onClick=${tick} className="glass p-8 rounded-[40px] flex flex-col items-center gap-3 active:scale-95 transition-all border border-blue-500/10">
                                        <${Lucide.FastForward} size=${32} className="text-blue-500" />
                                        <span className="font-black text-[11px] uppercase tracking-widest">Next Week</span>
                                    </button>
                                </div>

                                <div className="space-y-2">
                                    ${state.logs.map(l => html`
                                        <div key=${l.id} className="p-4 rounded-3xl glass text-xs font-bold border border-white/5">
                                            <span className=${l.type === 'error' ? 'text-red-500' : 'text-emerald-500'}>▶ </span> ${l.msg}
                                        </div>
                                    `)}
                                </div>
                            </div>
                        `}

                        ${view === 'darkweb' && html`
                            <div className="space-y-8">
                                <button onClick=${() => setView('home')} className="p-3 glass rounded-2xl"><${Lucide.ArrowLeft} /></button>
                                <h2 className="text-4xl font-black tracking-tighter">Underground</h2>
                                <div className="space-y-4">
                                    ${['Infiltrate Server', 'Hyper-Car Hijack', 'Crypto Exchange Raid'].map(op => html`
                                        <button key=${op} className="glass-dark p-8 rounded-[45px] w-full flex justify-between items-center border border-white/5">
                                            <span className="font-black">${op}</span>
                                            <span className="bg-red-600 px-4 py-1.5 rounded-full text-[10px] font-black uppercase">High Risk</span>
                                        </button>
                                    `)}
                                </div>
                            </div>
                        `}

                        ${view === 'academy' && html`
                            <div className="space-y-10">
                                <h2 className="text-4xl font-black tracking-tighter">Campus</h2>
                                <div className="space-y-6">
                                    <div className="glass p-8 rounded-[45px] border border-white/10">
                                        <div className="flex justify-between items-end mb-4">
                                            <span className="font-black text-xl uppercase tracking-tighter">Primary School</span>
                                            <span className="text-xs font-black text-emerald-400">${state.education.primary}/60</span>
                                        </div>
                                        <div className="stat-bar"><div className="stat-fill bg-emerald-500" style=${{ width: `${(state.education.primary/60)*100}%` }}></div></div>
                                        <button className="w-full bg-white text-black font-black mt-6 py-5 rounded-[25px] active:scale-95 disabled:opacity-30" disabled=${state.education.primary >= 60} onClick=${() => study('primary')}>Attend (+£12 / +Stats)</button>
                                    </div>
                                    <div className="glass p-8 rounded-[45px] border border-white/10">
                                        <div className="flex justify-between items-end mb-4">
                                            <span className="font-black text-xl uppercase tracking-tighter">Secondary Academy</span>
                                            <span className="text-xs font-black text-blue-400">${state.education.secondary}/60</span>
                                        </div>
                                        <div className="stat-bar"><div className="stat-fill bg-blue-500" style=${{ width: `${(state.education.secondary/60)*100}%` }}></div></div>
                                        <button className="w-full bg-white text-black font-black mt-6 py-5 rounded-[25px] active:scale-95 disabled:opacity-30" disabled=${state.education.primary < 60 || state.education.secondary >= 60} onClick=${() => study('secondary')}>Graduate (+£15 / +Stats)</button>
                                    </div>
                                </div>
                                <div className="grid grid-cols-2 gap-4">
                                    ${SUBJECTS.map(s => html`
                                        <button key=${s} onClick=${() => study('subject', s)} className="glass p-6 rounded-[35px] text-left border border-white/5 active:bg-white/10">
                                            <div className="font-black text-sm tracking-tighter">${s}</div>
                                            <div className="flex justify-between mt-2 items-center">
                                                <span className="text-[10px] font-black opacity-30">Lv ${state.education.subjects[s] || 0}</span>
                                                <span className="text-[10px] font-black text-red-500 italic">-£15</span>
                                            </div>
                                        </button>
                                    `)}
                                </div>
                            </div>
                        `}

                        ${view === 'shop' && html`
                            <div className="space-y-8">
                                <div className="flex gap-3 overflow-x-auto pb-4 no-scrollbar -mx-6 px-6">
                                    ${['iphones', 'samsungs', 'cars', 'houses', 'chains', 'rings'].map(p => html`
                                        <button key=${p} onClick=${() => setShopPage(p)} className=${`px-8 py-2.5 rounded-full font-black text-xs uppercase tracking-widest whitespace-nowrap border transition-all ${shopPage === p ? 'bg-white text-black border-white' : 'glass border-white/10 opacity-40'}`}>${p}</button>
                                    `)}
                                </div>
                                <div className="grid gap-4">
                                    ${shopPage === 'iphones' && IPHONES.map(i => html`<button key=${i.id} onClick=${() => purchase('phone', i)} className="glass p-7 rounded-[45px] flex justify-between items-center border border-white/5 active:scale-95"><div className="flex items-center gap-5"><${Lucide.Smartphone} className="opacity-30" size=${28} /><div><div className="font-black text-lg">${i.name}</div><div className="text-[10px] font-bold opacity-30">${i.brand}</div></div></div><span className="text-emerald-500 font-black">£${i.price.toLocaleString()}</span></button>`)}
                                    ${shopPage === 'samsungs' && SAMSUNGS.map(i => html`<button key=${i.id} onClick=${() => purchase('phone', i)} className="glass p-7 rounded-[45px] flex justify-between items-center border border-white/5 active:scale-95"><div className="flex items-center gap-5"><${Lucide.Smartphone} className="opacity-30" size=${28} /><div><div className="font-black text-lg">${i.name}</div><div className="text-[10px] font-bold opacity-30">${i.brand}</div></div></div><span className="text-emerald-500 font-black">£${i.price.toLocaleString()}</span></button>`)}
                                    ${shopPage === 'cars' && CARS.map(i => html`<button key=${i.id} onClick=${() => purchase('car', i)} className="glass p-7 rounded-[45px] flex justify-between items-center border border-white/5 active:scale-95"><div className="flex items-center gap-5"><div className="w-12 h-6 rounded-md shadow-lg" style=${{ backgroundColor: i.color }} /><div><div className="font-black text-lg">${i.name}</div><div className="text-[10px] font-bold opacity-30">Vehicle</div></div></div><span className="text-emerald-500 font-black">£${i.price.toLocaleString()}</span></button>`)}
                                    ${shopPage === 'houses' && HOUSES.map(i => html`<button key=${i.id} onClick=${() => purchase('house', i)} className="glass p-7 rounded-[45px] flex justify-between items-center border border-white/5 active:scale-95"><div className="flex items-center gap-5"><${Lucide.Home} className="opacity-30" size=${28} /><div><div className="font-black text-lg">${i.name}</div><div className="text-[10px] font-bold opacity-30">Real Estate</div></div></div><span className="text-emerald-500 font-black">£${i.price.toLocaleString()}</span></button>`)}
                                    ${shopPage === 'chains' && CHAINS.map(i => html`<button key=${i.id} onClick=${() => purchase('chain', i)} className="glass p-7 rounded-[45px] flex justify-between items-center border border-white/5 active:scale-95"><div className="flex items-center gap-5"><div className="w-10 h-10 rounded-full shadow-lg" style=${{ background: i.color }} /><div><div className="font-black text-lg">${i.name}</div><div className="text-[10px] font-bold opacity-30">Chain</div></div></div><span className="text-emerald-500 font-black">£${i.price}</span></button>`)}
                                    ${shopPage === 'rings' && RINGS.map(i => html`<button key=${i.id} onClick=${() => purchase('ring', i)} className="glass p-7 rounded-[45px] flex justify-between items-center border border-white/5 active:scale-95"><div className="flex items-center gap-5"><div className="w-8 h-8 rounded-full border-[3px]" style=${{ borderColor: i.color }} /><div><div className="font-black text-lg">${i.name}</div><div className="text-[10px] font-bold opacity-30">Ring</div></div></div><span className="text-emerald-500 font-black">£${i.price}</span></button>`)}
                                </div>
                            </div>
                        `}

                        ${view === 'phone' && html`
                            <div className="h-full flex flex-col items-center">
                                ${!phoneApp ? html`
                                    <div className="mt-20 flex flex-col items-center drop-shadow-2xl">
                                        <h2 className="text-8xl font-thin tracking-tighter mb-1">12:00</h2>
                                        <p className="text-xl font-medium opacity-50 tracking-[0.3em] uppercase">Protocol Active</p>
                                    </div>
                                    <div className="app-icon-grid mt-20 w-full">
                                        <button onClick=${() => setPhoneApp('store')} className="flex flex-col items-center gap-2">
                                            <div className="app-icon bg-blue-500"><${Lucide.ShoppingBag} size=${32} /></div>
                                            <span className="text-[10px] font-black uppercase tracking-tighter opacity-60">Store</span>
                                        </button>
                                        <button onClick=${() => setPhoneApp('tok')} className="flex flex-col items-center gap-2">
                                            <div className="app-icon bg-black border border-white/10"><${Lucide.Video} size=${32} /></div>
                                            <span className="text-[10px] font-black uppercase tracking-tighter opacity-60">ChowTok</span>
                                        </button>
                                        <button onClick=${() => setPhoneApp('chat')} className="flex flex-col items-center gap-2">
                                            <div className="app-icon bg-emerald-500"><${Lucide.MessageSquare} size=${32} /></div>
                                            <span className="text-[10px] font-black uppercase tracking-tighter opacity-60">Chat</span>
                                        </button>
                                        <button onClick=${() => setPhoneApp('ai')} className="flex flex-col items-center gap-2">
                                            <div className="app-icon bg-gradient-to-tr from-purple-600 to-indigo-600"><${Lucide.Zap} size=${32} /></div>
                                            <span className="text-[10px] font-black uppercase tracking-tighter opacity-60">Chow AI</span>
                                        </button>
                                    </div>
                                ` : html`
                                    <div className="w-full flex flex-col h-full bg-black/95 rounded-[50px] border border-white/10 overflow-hidden shadow-2xl">
                                        <header className="p-7 border-b border-white/5 flex items-center justify-between glass">
                                            <button onClick=${() => setPhoneApp(null)} className="p-2 active:scale-90"><${Lucide.ChevronLeft} /></button>
                                            <span className="font-black uppercase text-xs tracking-[0.3em]">${phoneApp}</span>
                                            <div className="w-10" />
                                        </header>
                                        <div className="flex-1 overflow-y-auto p-7 no-scrollbar">
                                            ${phoneApp === 'ai' && html`
                                                <div className="flex flex-col h-full">
                                                    <div className="flex-1 space-y-5 mb-5 overflow-y-auto max-h-[420px] no-scrollbar">
                                                        <div className="bg-white/5 p-5 rounded-[28px] border border-white/5">
                                                            <p className="text-[10px] font-black opacity-30 uppercase tracking-widest mb-2">Chow Neural Link</p>
                                                            <p className="text-sm leading-relaxed">Identity ${state.name} confirmed. Protocol active. How can I assist your biological evolution?</p>
                                                        </div>
                                                        ${aiResponse && html`
                                                            <div className="bg-blue-600/10 p-5 rounded-[28px] border border-blue-600/20 ml-8 animate-in slide-in-from-right shadow-lg">
                                                                <p className="text-[10px] font-black text-blue-400 uppercase tracking-widest mb-2">Chow AI Response</p>
                                                                <p className="text-sm leading-relaxed">${aiResponse}</p>
                                                            </div>
                                                        `}
                                                    </div>
                                                    <div className="flex gap-3 p-2 glass rounded-[32px] border border-white/10">
                                                        <input className="flex-1 bg-transparent p-4 text-sm font-bold" placeholder="Query hub..." value=${aiQuery} onChange=${e => setAiQuery(e.target.value)} onKeyDown=${e => e.key === 'Enter' && handleAi()} />
                                                        <button onClick=${handleAi} className="bg-blue-600 w-12 h-12 rounded-[22px] flex items-center justify-center active:scale-90 shadow-lg" disabled=${isAiLoading}>
                                                            ${isAiLoading ? html`<div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>` : html`<${Lucide.ArrowUp} size=${20} />`}
                                                        </button>
                                                    </div>
                                                </div>
                                            `}
                                            ${phoneApp === 'tok' && html`
                                                <div className="flex flex-col items-center gap-10 py-12">
                                                    <div className="w-44 h-44 rounded-full bg-gradient-to-br from-pink-500 via-red-500 to-yellow-500 p-1.5 shadow-[0_0_40px_rgba(236,72,153,0.3)] animate-pulse">
                                                        <div className="w-full h-full bg-black rounded-full flex items-center justify-center font-black text-5xl italic tracking-tighter">C</div>
                                                    </div>
                                                    <div className="text-center space-y-1">
                                                        <div className="text-6xl font-black tracking-tighter">${state.social.followers.toLocaleString()}</div>
                                                        <div className="text-[11px] font-black opacity-30 uppercase tracking-[0.5em]">Followers</div>
                                                    </div>
                                                    <button onClick=${() => setState(p => ({...p, social: {...p.social, followers: p.social.followers + 300}}))} className="w-full bg-white text-black font-black py-6 rounded-[30px] active:scale-95 shadow-xl transition-all uppercase tracking-widest text-sm">Post Viral Clip (+300)</button>
                                                </div>
                                            `}
                                            ${phoneApp === 'chat' && html`<div className="flex flex-col items-center justify-center py-32 opacity-20 text-center"><${Lucide.MessagesSquare} size=${64} className="mb-6" /><p className="font-black uppercase tracking-widest text-xs">Signal Encrypted</p></div>`}
                                            ${phoneApp === 'store' && html`<div className="space-y-4">${['ChowTok', 'Chow AI', 'Protocol Chat'].map(a => html`<div key=${a} className="flex items-center justify-between p-5 glass rounded-[35px] border border-white/5"><div className="flex items-center gap-4"><div className="w-12 h-12 bg-zinc-800 rounded-2xl flex items-center justify-center"><${Lucide.AppWindow} /></div><div><div className="font-black text-sm">${a}</div><div className="text-[10px] opacity-30 font-black uppercase tracking-widest">Utility</div></div></div><button className="bg-white/10 px-6 py-2 rounded-full text-[10px] font-black uppercase tracking-widest border border-white/5">Open</button></div>`)}</div>`}
                                        </div>
                                    </div>
                                `}
                            </div>
                        `}

                        ${view === 'profile' && html`
                            <div className="space-y-10 animate-in slide-in-from-right">
                                <h2 className="text-4xl font-black tracking-tighter">Identity</h2>
                                <div className="glass p-12 rounded-[75px] flex flex-col items-center ios-shadow border border-white/10">
                                    <${CharacterVisual} state=${state} scale=${1.8} />
                                    <h3 className="text-4xl font-black mt-14 tracking-tighter">${state.name}</h3>
                                    <div className="flex gap-4 mt-6">
                                        <span className="bg-white/10 px-8 py-2 rounded-full text-[10px] font-black uppercase tracking-widest border border-white/5">${state.gender}</span>
                                        <span className="bg-blue-600 px-8 py-2 rounded-full text-[10px] font-black uppercase tracking-widest shadow-lg shadow-blue-500/20">Lv. ${state.age}</span>
                                    </div>
                                    <div className="w-full mt-14 grid grid-cols-2 gap-5">
                                        <div className="p-7 bg-white/5 rounded-[40px] border border-white/5 text-center">
                                            <div className="text-[9px] font-black opacity-20 uppercase tracking-widest mb-2">Asset</div>
                                            <div className="text-sm font-black truncate">${state.assets.house.name}</div>
                                        </div>
                                        <div className="p-7 bg-white/5 rounded-[40px] border border-white/5 text-center">
                                            <div className="text-[9px] font-black opacity-20 uppercase tracking-widest mb-2">Garage</div>
                                            <div className="text-sm font-black truncate">${state.assets.car?.name || 'On Foot'}</div>
                                        </div>
                                        <div className="p-7 bg-white/5 rounded-[40px] border border-white/5 text-center col-span-2">
                                            <div className="text-[9px] font-black opacity-20 uppercase tracking-widest mb-2">Net Value</div>
                                            <div className="text-2xl font-black text-emerald-400">£${(state.money + (state.assets.car?.price || 0) + (state.assets.house.price || 0)).toLocaleString()}</div>
                                        </div>
                                    </div>
                                    <button 
                                        onClick=${() => { if(confirm("Terminate protocol and start new identity?")) { localStorage.removeItem('chow_sim_u_v26_final'); window.location.reload(); } }}
                                        className="mt-16 text-red-500/40 hover:text-red-500 text-[10px] font-black uppercase tracking-[0.4em] active:scale-95 transition-all"
                                    >Terminate Life Protocol</button>
                                </div>
                            </div>
                        `}
                    </main>

                    <nav className="fixed bottom-0 left-0 right-0 glass pb-12 pt-6 px-10 z-50 border-t border-white/5">
                        <div className="flex justify-between items-center max-w-md mx-auto">
                            <NavBtn icon=${Lucide.GraduationCap} label="Academy" active=${view === 'academy'} onClick=${() => setView('academy')} />
                            <NavBtn icon=${Lucide.Home} label="Home" active=${view === 'home'} onClick=${() => setView('home')} />
                            ${state.assets.phone && html`<NavBtn icon=${Lucide.Smartphone} label="iPhone" active=${view === 'phone'} onClick=${() => { setView('phone'); setPhoneApp(null); }} />`}
                            <NavBtn icon=${Lucide.ShoppingCart} label="Shop" active=${view === 'shop'} onClick=${() => setView('shop')} />
                            <NavBtn icon=${Lucide.UserCircle} label="Profile" active=${view === 'profile'} onClick=${() => setView('profile')} />
                        </div>
                    </nav>
                </div>
            `;
        };

        const NavBtn = ({ icon: Icon, label, active, onClick }) => html`
            <button onClick=${onClick} className=${`flex flex-col items-center gap-1.5 transition-all duration-300 ${active ? 'text-blue-500 scale-110' : 'opacity-40 hover:opacity-100'}`}>
                <${Icon} size=${28} strokeWidth=${active ? 3 : 2} />
                <span className="text-[9px] font-black uppercase tracking-tighter">${label}</span>
            </button>
        `;

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(html`<${App} />`);
    </script>
</body>
</html>
