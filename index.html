<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>Chow Sim iOS 26 - Ultimate Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        ::-webkit-scrollbar { display: none; }
        body {
            background-color: #000;
            color: #fff;
            overscroll-behavior: none;
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            padding-bottom: env(safe-area-inset-bottom);
        }
        input { -webkit-user-select: text; user-select: text; outline: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-float { animation: float 4s infinite ease-in-out; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .ios-shadow { box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.5); }
        .app-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="module">
        import React, { useState, useEffect, useRef } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import htm from 'https://esm.sh/htm';
        import * as Lucide from 'https://esm.sh/lucide-react@0.263.1';
        import { GoogleGenAI } from "@google/genai";

        const html = htm.bind(React.createElement);

        // --- GAME CONSTANTS & EXPANDED DATA ---

        const COLORS = {
            copper: '#b87333', coal: '#1a1a1a', silver: '#e4e4e7', gold: '#fbbf24',
            platinum: '#e0f2fe', emerald: '#10b981', ruby: '#ef4444', sapphire: '#3b82f6',
            amethyst: '#a855f7', diamond: '#b9f2ff', obsidian: '#050505',
            rainbow: 'linear-gradient(45deg, #ff0000, #ffff00, #00ff00, #0000ff, #9400d3)'
        };

        const PHONES = Array.from({ length: 21 }, (_, i) => ({
            id: `ip-${i}`,
            name: i === 0 ? "Nokia Brick" : `iPhone ${i + 1} Pro`,
            price: 50 + (i * 250),
            brand: 'Apple'
        }));

        const SAMSUNGS = Array.from({ length: 10 }, (_, i) => ({
            id: `ss-${i}`,
            name: `Samsung S${20 + i} Ultra`,
            price: 500 + (i * 300),
            brand: 'Samsung'
        }));

        const CARS = [
            { name: "Bicycle", price: 100, color: "#555" },
            { name: "Skateboard", price: 50, color: "#333" },
            { name: "Rusty Sedan", price: 500, color: "#8B4513" },
            { name: "Old Moped", price: 800, color: "#facc15" },
            { name: "Toyota Camry", price: 15000, color: "#C0C0C0" },
            { name: "Honda Civic", price: 20000, color: "#fff" },
            { name: "Ford Mustang", price: 35000, color: "#ef4444" },
            { name: "BMW 3 Series", price: 45000, color: "#111" },
            { name: "Audi A6", price: 55000, color: "#3b82f6" },
            { name: "Tesla Model 3", price: 40000, color: "#fff" },
            { name: "Range Rover", price: 90000, color: "#065f46" },
            { name: "Porsche 911", price: 120000, color: "#facc15" },
            { name: "Mercedes S-Class", price: 110000, color: "#000" },
            { name: "Nissan GT-R", price: 115000, color: "#444" },
            { name: "Lamborghini Huracan", price: 250000, color: "#fbbf24" },
            { name: "Ferrari 488", price: 280000, color: "#dc2626" },
            { name: "McLaren 720S", price: 300000, color: "#ea580c" },
            { name: "Aston Martin DB11", price: 220000, color: "#1e293b" },
            { name: "Rolls Royce Cullinan", price: 450000, color: "#000" },
            { name: "Bugatti Veyron", price: 1500000, color: "#1e3a8a" },
            { name: "Private Jet", price: 15000000, color: "#fff" }
        ];

        const HOUSES = Array.from({ length: 21 }, (_, i) => ({
            id: `h-${i}`,
            name: i === 0 ? "Cardboard Box" : i < 5 ? `Apartment Block ${i}` : i < 15 ? `Suburban House ${i}` : `Palace Level ${i - 14}`,
            price: i === 0 ? 0 : 5000 * Math.pow(2, i),
            rent: i === 0 ? 0 : 50 * Math.pow(1.5, i)
        }));

        const RINGS = Object.keys(COLORS).map(k => ({ name: `${k.charAt(0).toUpperCase() + k.slice(1)} Ring`, color: COLORS[k], price: 1500 }));
        const CHAINS = Object.keys(COLORS).map(k => ({ name: `${k.charAt(0).toUpperCase() + k.slice(1)} Chain`, color: COLORS[k], price: 3000 }));

        const SUBJECTS = [
            'Maths', 'Physics', 'Biology', 'Chemistry', 'Art', 'Music', 'History', 'Geography', 'Computing', 'Business', 'Philosophy', 'Law'
        ];

        const INITIAL_STATE = {
            hasStarted: false,
            name: "New Citizen",
            gender: 'male',
            money: 500,
            age: 12,
            week: 1,
            health: 100,
            happiness: 100,
            jail: 0,
            education: {
                primary: 0,
                secondary: 0,
                subjects: SUBJECTS.reduce((acc, s) => ({ ...acc, [s]: 0 }), {})
            },
            assets: {
                house: HOUSES[0],
                car: null,
                chain: null,
                ring: null,
                phone: null
            },
            chowtok: { followers: 0, likes: 0 },
            isDead: false,
            logs: []
        };

        // --- UTILITY COMPONENTS ---

        const ProgressBar = ({ value, max, color }) => html`
            <div className="h-2 bg-zinc-800 rounded-full overflow-hidden w-full">
                <div className="h-full transition-all duration-500" style=${{ width: `${Math.min(100, (value / max) * 100)}%`, backgroundColor: color }} />
            </div>
        `;

        const CharacterVisual = ({ state, large = false }) => {
            const { gender, assets } = state;
            const chainColor = assets.chain ? assets.chain.color : 'transparent';
            const ringColor = assets.ring ? assets.ring.color : 'transparent';
            const carColor = assets.car ? assets.car.color : 'transparent';

            return html`
                <div className=${`relative flex flex-col items-center justify-center ${large ? 'scale-150 py-20' : 'scale-100 py-10'}`}>
                    <!-- Car Background -->
                    ${assets.car && html`
                        <div className="absolute -z-10 opacity-30 blur-sm translate-y-4">
                            <svg width="200" height="100" viewBox="0 0 200 100">
                                <path d="M20 70 L40 40 L160 40 L180 70 L190 90 L10 90 Z" fill=${carColor} />
                                <circle cx="50" cy="85" r="12" fill="#111" />
                                <circle cx="150" cy="85" r="12" fill="#111" />
                            </svg>
                        </div>
                    `}
                    
                    <!-- Character Body -->
                    <div className="relative">
                        <!-- Head -->
                        <div className="w-16 h-16 bg-[#ffdbac] rounded-full relative z-20 overflow-hidden shadow-inner">
                             ${gender === 'female' ? html`<div className="absolute top-0 w-full h-8 bg-[#3e2723] rounded-t-full" />` : html`<div className="absolute top-0 w-full h-2 bg-[#2d1a12] rounded-t-full" />`}
                             <!-- Eyes -->
                             <div className="flex justify-around mt-6 px-3">
                                <div className="w-2 h-2 bg-black rounded-full" />
                                <div className="w-2 h-2 bg-black rounded-full" />
                             </div>
                        </div>
                        
                        <!-- Neck / Chain -->
                        <div className="w-4 h-2 bg-[#ffdbac] mx-auto relative z-10">
                            ${assets.chain && html`<div className="absolute top-0 left-[-4px] right-[-4px] h-2 rounded-full border-b-2" style=${{ borderColor: chainColor }} />`}
                        </div>

                        <!-- Torso -->
                        <div className="w-20 h-24 bg-zinc-100 rounded-t-2xl relative z-10">
                            <!-- Arms -->
                            <div className="absolute -left-6 top-2 w-6 h-16 bg-[#ffdbac] rounded-full origin-top rotate-[15deg] flex items-end justify-center">
                                ${assets.ring && html`<div className="w-3 h-1 rounded-full mb-2" style=${{ backgroundColor: ringColor }} />`}
                            </div>
                            <div className="absolute -right-6 top-2 w-6 h-16 bg-[#ffdbac] rounded-full origin-top -rotate-[15deg] flex items-end justify-center">
                                <!-- Holding Phone -->
                                ${assets.phone && html`
                                    <div className="w-8 h-12 bg-black rounded-lg border border-zinc-700 shadow-xl flex items-center justify-center -rotate-12 mb-2">
                                        <div className="w-1 h-1 bg-zinc-600 rounded-full mb-8" />
                                    </div>
                                `}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };

        // --- MAIN APP ---

        function App() {
            const [state, setState] = useState(() => {
                const saved = localStorage.getItem('chow_sim_v26');
                return saved ? JSON.parse(saved) : INITIAL_STATE;
            });
            const [view, setView] = useState('home'); 
            const [shopTab, setShopTab] = useState('phones');
            const [phoneApp, setPhoneApp] = useState(null);
            const [aiQuery, setAiQuery] = useState('');
            const [aiResponse, setAiResponse] = useState('');
            const [isAiLoading, setIsAiLoading] = useState(false);

            useEffect(() => {
                localStorage.setItem('chow_sim_v26', JSON.stringify(state));
                if (state.health <= 0 || state.happiness <= 0) {
                    setState(p => ({ ...p, isDead: true }));
                }
            }, [state]);

            const log = (msg, type = 'info') => {
                setState(p => ({ ...p, logs: [{ id: Date.now(), msg, type }, ...p.logs].slice(0, 5) }));
            };

            const tick = () => {
                setState(prev => {
                    const nextWeek = prev.week + 1;
                    const nextAge = nextWeek > 52 ? prev.age + 1 : prev.age;
                    const displayWeek = nextWeek > 52 ? 1 : nextWeek;
                    return {
                        ...prev,
                        week: displayWeek,
                        age: nextAge,
                        money: prev.money + (prev.age > 18 ? 200 : 20), // Basic allowance
                        health: Math.max(0, prev.health - (prev.age > 50 ? 2 : 1)),
                        happiness: Math.max(0, prev.happiness - 1)
                    };
                });
            };

            // Education Logic
            const doEducation = (type, sub = null) => {
                if (state.money < (type === 'subject' ? 10 : 0)) return log("Not enough money!", "error");

                setState(prev => {
                    let cost = 0;
                    let hMod = 0;
                    let hpMod = 0;
                    let mMod = 0;
                    let nextEdu = { ...prev.education };

                    if (type === 'primary') {
                        if (prev.education.primary >= 60) return prev;
                        nextEdu.primary += 1;
                        mMod = 10; hpMod = 2; hMod = 2;
                    } else if (type === 'secondary') {
                        if (prev.education.primary < 60) { log("Need primary first!"); return prev; }
                        if (prev.education.secondary >= 60) return prev;
                        nextEdu.secondary += 1;
                        mMod = 10; hpMod = 2; hMod = 2;
                    } else if (type === 'subject') {
                        if (prev.education.secondary < 60) { log("Need high school graduation!"); return prev; }
                        nextEdu.subjects[sub] = (nextEdu.subjects[sub] || 0) + 1;
                        cost = 10; hpMod = -2; hMod = -2;
                    }

                    return {
                        ...prev,
                        money: prev.money + mMod - cost,
                        health: Math.min(100, Math.max(0, prev.health + hMod)),
                        happiness: Math.min(100, Math.max(0, prev.happiness + hpMod)),
                        education: nextEdu
                    };
                });
            };

            const buyItem = (category, item) => {
                if (state.money < item.price) return log("Too expensive!", "error");
                setState(prev => ({
                    ...prev,
                    money: prev.money - item.price,
                    assets: { ...prev.assets, [category]: item },
                    happiness: Math.min(100, prev.happiness + 10)
                }));
                log(`Bought ${item.name}!`);
            };

            // AI Logic
            const askChowAi = async () => {
                if (!aiQuery) return;
                setIsAiLoading(true);
                setAiResponse("Thinking...");
                try {
                    const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                    const response = await ai.models.generateContent({
                        model: 'gemini-3-flash-preview',
                        contents: aiQuery,
                        config: { systemInstruction: "You are Chow AI, a helpful virtual assistant in a life simulator game. Be concise." }
                    });
                    setAiResponse(response.text);
                } catch (err) {
                    setAiResponse("Error connecting to neural link.");
                }
                setIsAiLoading(false);
            };

            // --- RENDER VIEWS ---

            if (state.isDead) {
                return html`
                    <div className="min-h-screen bg-red-950 flex flex-col items-center justify-center p-10 text-center">
                        <${Lucide.Skull} size=${80} className="mb-6 animate-bounce" />
                        <h1 className="text-6xl font-black mb-4 uppercase tracking-tighter">Wasted</h1>
                        <p className="text-xl mb-10 opacity-70">Life comes to an end eventually. Try better next time.</p>
                        <button onClick=${() => { localStorage.removeItem('chow_sim_v26'); window.location.reload(); }} className="bg-white text-black px-10 py-5 rounded-full font-black text-xl shadow-2xl">NEW LIFE</button>
                    </div>
                `;
            }

            if (!state.hasStarted) {
                return html`
                    <div className="min-h-screen bg-black flex flex-col items-center justify-center p-8">
                        <div className="w-full max-w-sm glass p-8 rounded-[40px] text-center ios-shadow">
                            <h1 className="text-4xl font-black mb-2 tracking-tighter">CHOW SIM</h1>
                            <p className="text-xs font-bold uppercase tracking-widest opacity-40 mb-8">iOS 26 Ultimate</p>
                            <input className="w-full bg-white/10 p-5 rounded-2xl mb-4 font-bold" placeholder="Your Name" value=${state.name} onChange=${e => setState(p => ({...p, name: e.target.value}))} />
                            <div className="grid grid-cols-2 gap-3 mb-8">
                                <button className=${`p-4 rounded-2xl font-black ${state.gender === 'male' ? 'bg-white text-black' : 'bg-white/5'}`} onClick=${() => setState(p => ({...p, gender: 'male'}))}>MALE</button>
                                <button className=${`p-4 rounded-2xl font-black ${state.gender === 'female' ? 'bg-white text-black' : 'bg-white/5'}`} onClick=${() => setState(p => ({...p, gender: 'female'}))}>FEMALE</button>
                            </div>
                            <button className="w-full bg-blue-600 p-5 rounded-2xl font-black text-xl" onClick=${() => setState(p => ({...p, hasStarted: true}))}>START LIFE</button>
                        </div>
                    </div>
                `;
            }

            return html`
                <div className="min-h-screen bg-black flex flex-col">
                    <!-- Status Bar -->
                    <header className="p-6 pt-12 glass z-50">
                        <div className="flex justify-between items-end mb-4">
                            <div>
                                <h1 className="text-2xl font-black tracking-tighter">${state.name}</h1>
                                <div className="text-[10px] font-bold opacity-40 uppercase tracking-widest">Age ${state.age} • Week ${state.week}</div>
                            </div>
                            <div className="text-3xl font-black">£${state.money.toLocaleString()}</div>
                        </div>
                        <div className="space-y-2">
                            <div className="flex items-center gap-3">
                                <${Lucide.Heart} size=${14} className="text-red-500" />
                                <${ProgressBar} value=${state.health} max=${100} color="#ef4444" />
                            </div>
                            <div className="flex items-center gap-3">
                                <${Lucide.Smile} size=${14} className="text-yellow-500" />
                                <${ProgressBar} value=${state.happiness} max=${100} color="#eab308" />
                            </div>
                        </div>
                    </header>

                    <!-- Main Content Area -->
                    <main className="flex-1 overflow-y-auto p-4 pb-40 no-scrollbar">
                        
                        ${view === 'home' && html`
                            <div className="space-y-6">
                                <div className="glass p-8 rounded-[40px] flex flex-col items-center">
                                    <${CharacterVisual} state=${state} large=${true} />
                                    <div className="mt-4 text-center">
                                        <div className="text-sm font-bold opacity-40 uppercase">Job</div>
                                        <div className="text-xl font-black">${state.age < 16 ? 'Student' : 'Unemployed'}</div>
                                    </div>
                                </div>

                                <div className="grid grid-cols-2 gap-4">
                                    <button className="glass p-6 rounded-3xl flex flex-col items-center gap-2 group active:scale-95 transition-all" onClick=${() => setView('darkweb')}>
                                        <div className="w-12 h-12 bg-red-600/20 rounded-2xl flex items-center justify-center text-red-500"><${Lucide.Skull} /></div>
                                        <span className="font-black text-xs uppercase">Dark Web</span>
                                    </button>
                                    <button className="glass p-6 rounded-3xl flex flex-col items-center gap-2 active:scale-95 transition-all" onClick=${tick}>
                                        <div className="w-12 h-12 bg-blue-600/20 rounded-2xl flex items-center justify-center text-blue-500"><${Lucide.Plus} /></div>
                                        <span className="font-black text-xs uppercase">Next Week</span>
                                    </button>
                                </div>

                                <div className="space-y-2">
                                    ${state.logs.map(l => html`
                                        <div key=${l.id} className="p-4 rounded-2xl bg-white/5 border border-white/5 text-xs font-bold animate-in slide-in-from-left">
                                            <span className=${l.type === 'error' ? 'text-red-500' : 'text-green-500'}>• </span> ${l.msg}
                                        </div>
                                    `)}
                                </div>
                            </div>
                        `}

                        ${view === 'darkweb' && html`
                            <div className="space-y-6 animate-in fade-in zoom-in">
                                <div className="flex items-center gap-4 mb-4">
                                    <button onClick=${() => setView('home')}><${Lucide.ArrowLeft} /></button>
                                    <h2 className="text-3xl font-black">Dark Web</h2>
                                </div>
                                <p className="text-red-500 font-bold text-xs bg-red-500/10 p-4 rounded-xl">WARNING: High risk of prison time. Illegal activities below.</p>
                                <div className="grid gap-3">
                                    <button className="glass p-6 rounded-3xl flex justify-between items-center group active:bg-red-900/40">
                                        <span className="font-bold">Hack Bank Account</span>
                                        <span className="text-red-500 font-black text-xs">Risk 60%</span>
                                    </button>
                                    <button className="glass p-6 rounded-3xl flex justify-between items-center group active:bg-red-900/40">
                                        <span className="font-bold">Grand Theft Auto</span>
                                        <span className="text-red-500 font-black text-xs">Risk 40%</span>
                                    </button>
                                    <button className="glass p-6 rounded-3xl flex justify-between items-center group active:bg-red-900/40">
                                        <span className="font-bold">Heist Luxury Store</span>
                                        <span className="text-red-500 font-black text-xs">Risk 85%</span>
                                    </button>
                                </div>
                            </div>
                        `}

                        ${view === 'edu' && html`
                            <div className="space-y-8 animate-in slide-in-from-bottom">
                                <h2 className="text-4xl font-black tracking-tighter">Campus</h2>
                                
                                <section className="space-y-4">
                                    <div className="glass p-6 rounded-3xl">
                                        <div className="flex justify-between items-center mb-2">
                                            <span className="font-black text-xs uppercase tracking-widest">Primary School</span>
                                            <span className="text-xs font-bold text-green-400">${state.education.primary}/60</span>
                                        </div>
                                        <${ProgressBar} value=${state.education.primary} max=${60} color="#10b981" />
                                        <button className="w-full bg-white text-black font-black mt-4 py-3 rounded-xl active:scale-95 disabled:opacity-50" disabled=${state.education.primary >= 60} onClick=${() => doEducation('primary')}>Attend (+£10)</button>
                                    </div>

                                    <div className="glass p-6 rounded-3xl">
                                        <div className="flex justify-between items-center mb-2">
                                            <span className="font-black text-xs uppercase tracking-widest">High School</span>
                                            <span className="text-xs font-bold text-blue-400">${state.education.secondary}/60</span>
                                        </div>
                                        <${ProgressBar} value=${state.education.secondary} max=${60} color="#3b82f6" />
                                        <button className="w-full bg-white text-black font-black mt-4 py-3 rounded-xl active:scale-95 disabled:opacity-50" disabled=${state.education.primary < 60 || state.education.secondary >= 60} onClick=${() => doEducation('secondary')}>Attend (+£10)</button>
                                    </div>
                                </section>

                                <section>
                                    <h3 className="text-xs font-black uppercase tracking-widest opacity-40 mb-4">University Degrees</h3>
                                    <div className="grid grid-cols-2 gap-3">
                                        ${SUBJECTS.map(s => html`
                                            <button key=${s} className="glass p-4 rounded-2xl flex flex-col gap-1 items-start active:bg-white/10" onClick=${() => doEducation('subject', s)}>
                                                <span className="font-bold text-sm">${s}</span>
                                                <div className="flex justify-between w-full items-center">
                                                    <span className="text-[9px] font-black opacity-40 uppercase">LVL ${state.education.subjects[s] || 0}</span>
                                                    <span className="text-[9px] font-bold text-red-500">-£10</span>
                                                </div>
                                            </button>
                                        `)}
                                    </div>
                                </section>
                            </div>
                        `}

                        ${view === 'shop' && html`
                            <div className="space-y-6">
                                <div className="flex overflow-x-auto gap-2 pb-2 no-scrollbar">
                                    ${['phones', 'samsungs', 'cars', 'houses', 'chains', 'rings'].map(t => html`
                                        <button key=${t} onClick=${() => setShopTab(t)} className=${`px-6 py-2 rounded-full font-black text-xs uppercase tracking-widest transition-all ${shopTab === t ? 'bg-white text-black' : 'bg-white/10'}`}>${t}</button>
                                    `)}
                                </div>

                                <div className="grid gap-3">
                                    ${shopTab === 'phones' && PHONES.map(p => html`
                                        <button key=${p.id} onClick=${() => buyItem('phone', p)} className="glass p-6 rounded-3xl flex justify-between items-center active:scale-95">
                                            <div className="flex items-center gap-4">
                                                <${Lucide.Smartphone} className="opacity-40" />
                                                <span className="font-bold">${p.name}</span>
                                            </div>
                                            <span className="text-green-500 font-black">£${p.price.toLocaleString()}</span>
                                        </button>
                                    `)}
                                    ${shopTab === 'samsungs' && SAMSUNGS.map(p => html`
                                        <button key=${p.id} onClick=${() => buyItem('phone', p)} className="glass p-6 rounded-3xl flex justify-between items-center active:scale-95">
                                            <div className="flex items-center gap-4">
                                                <${Lucide.Tablet} className="opacity-40" />
                                                <span className="font-bold">${p.name}</span>
                                            </div>
                                            <span className="text-green-500 font-black">£${p.price.toLocaleString()}</span>
                                        </button>
                                    `)}
                                    ${shopTab === 'cars' && CARS.map(c => html`
                                        <button key=${c.name} onClick=${() => buyItem('car', c)} className="glass p-6 rounded-3xl flex justify-between items-center active:scale-95">
                                            <div className="flex items-center gap-4">
                                                <div className="w-8 h-4 rounded-full" style=${{ backgroundColor: c.color }} />
                                                <span className="font-bold">${c.name}</span>
                                            </div>
                                            <span className="text-green-500 font-black">£${c.price.toLocaleString()}</span>
                                        </button>
                                    `)}
                                    ${shopTab === 'houses' && HOUSES.map(h => html`
                                        <button key=${h.id} onClick=${() => buyItem('house', h)} className="glass p-6 rounded-3xl flex justify-between items-center active:scale-95">
                                            <div className="flex items-center gap-4">
                                                <${Lucide.Home} className="opacity-40" />
                                                <span className="font-bold">${h.name}</span>
                                            </div>
                                            <span className="text-green-500 font-black">£${h.price.toLocaleString()}</span>
                                        </button>
                                    `)}
                                    ${shopTab === 'chains' && CHAINS.map(c => html`
                                        <button key=${c.name} onClick=${() => buyItem('chain', c)} className="glass p-6 rounded-3xl flex justify-between items-center active:scale-95">
                                            <div className="flex items-center gap-4">
                                                <div className="w-6 h-6 rounded-full" style=${{ background: c.color }} />
                                                <span className="font-bold">${c.name}</span>
                                            </div>
                                            <span className="text-green-500 font-black">£${c.price.toLocaleString()}</span>
                                        </button>
                                    `)}
                                    ${shopTab === 'rings' && RINGS.map(r => html`
                                        <button key=${r.name} onClick=${() => buyItem('ring', r)} className="glass p-6 rounded-3xl flex justify-between items-center active:scale-95">
                                            <div className="flex items-center gap-4">
                                                <div className="w-4 h-4 rounded-full border-2" style=${{ borderColor: r.color }} />
                                                <span className="font-bold">${r.name}</span>
                                            </div>
                                            <span className="text-green-500 font-black">£${r.price.toLocaleString()}</span>
                                        </button>
                                    `)}
                                </div>
                            </div>
                        `}

                        ${view === 'profile' && html`
                            <div className="space-y-8 animate-in slide-in-from-right">
                                <h2 className="text-4xl font-black tracking-tighter">My Identity</h2>
                                <div className="glass p-10 rounded-[60px] flex flex-col items-center">
                                    <${CharacterVisual} state=${state} large=${true} />
                                    <h3 className="text-3xl font-black mt-10">${state.name}</h3>
                                    <div className="flex gap-2 mt-4">
                                        <span className="bg-white/10 px-4 py-1 rounded-full text-[10px] font-black uppercase">${state.gender}</span>
                                        <span className="bg-blue-600 px-4 py-1 rounded-full text-[10px] font-black uppercase">Lv. ${state.age}</span>
                                    </div>
                                    
                                    <div className="w-full mt-10 grid grid-cols-2 gap-4">
                                        <div className="p-5 bg-white/5 rounded-3xl text-center border border-white/5">
                                            <div className="text-[10px] font-bold opacity-30 uppercase mb-1">Residence</div>
                                            <div className="text-sm font-black truncate">${state.assets.house.name}</div>
                                        </div>
                                        <div className="p-5 bg-white/5 rounded-3xl text-center border border-white/5">
                                            <div className="text-[10px] font-bold opacity-30 uppercase mb-1">Vehicle</div>
                                            <div className="text-sm font-black truncate">${state.assets.car?.name || 'On Foot'}</div>
                                        </div>
                                        <div className="p-5 bg-white/5 rounded-3xl text-center border border-white/5">
                                            <div className="text-[10px] font-bold opacity-30 uppercase mb-1">Smartphone</div>
                                            <div className="text-sm font-black truncate">${state.assets.phone?.name || 'None'}</div>
                                        </div>
                                        <div className="p-5 bg-white/5 rounded-3xl text-center border border-white/5">
                                            <div className="text-[10px] font-bold opacity-30 uppercase mb-1">Net Worth</div>
                                            <div className="text-sm font-black text-green-500">£${(state.money + (state.assets.car?.price || 0) + (state.assets.house.price || 0)).toLocaleString()}</div>
                                        </div>
                                    </div>

                                    <button className="mt-12 text-red-500/50 hover:text-red-500 text-[10px] font-black uppercase tracking-[0.2em]" onClick=${() => { localStorage.removeItem('chow_sim_v26'); window.location.reload(); }}>End Current Life</button>
                                </div>
                            </div>
                        `}

                        ${view === 'phone' && html`
                            <div className="h-full flex flex-col items-center animate-in slide-in-from-bottom duration-500">
                                ${!phoneApp ? html`
                                    <!-- iPhone Lock Screen Look -->
                                    <div className="mt-20 flex flex-col items-center">
                                        <h2 className="text-7xl font-light mb-2">12:00</h2>
                                        <p className="text-lg font-medium opacity-60">Monday, 1 January</p>
                                    </div>
                                    <div className="app-grid mt-20 p-6 w-full">
                                        <button onClick=${() => setPhoneApp('store')} className="flex flex-col items-center gap-1 group">
                                            <div className="w-16 h-16 bg-blue-500 rounded-2xl flex items-center justify-center text-white shadow-lg active:scale-90 transition-transform"><${Lucide.ShoppingBag} size=${32} /></div>
                                            <span className="text-[10px] font-medium opacity-80 group-active:opacity-100">App Store</span>
                                        </button>
                                        <button onClick=${() => setPhoneApp('tok')} className="flex flex-col items-center gap-1 group">
                                            <div className="w-16 h-16 bg-black rounded-2xl flex items-center justify-center text-white border border-white/20 shadow-lg active:scale-90 transition-transform"><${Lucide.Video} size=${32} /></div>
                                            <span className="text-[10px] font-medium opacity-80 group-active:opacity-100">ChowTok</span>
                                        </button>
                                        <button onClick=${() => setPhoneApp('chat')} className="flex flex-col items-center gap-1 group">
                                            <div className="w-16 h-16 bg-green-500 rounded-2xl flex items-center justify-center text-white shadow-lg active:scale-90 transition-transform"><${Lucide.MessageCircle} size=${32} /></div>
                                            <span className="text-[10px] font-medium opacity-80 group-active:opacity-100">Chow Chat</span>
                                        </button>
                                        <button onClick=${() => setPhoneApp('ai')} className="flex flex-col items-center gap-1 group">
                                            <div className="w-16 h-16 bg-gradient-to-tr from-purple-600 to-pink-500 rounded-2xl flex items-center justify-center text-white shadow-lg active:scale-90 transition-transform"><${Lucide.Zap} size=${32} /></div>
                                            <span className="text-[10px] font-medium opacity-80 group-active:opacity-100">Chow AI</span>
                                        </button>
                                    </div>
                                ` : html`
                                    <div className="w-full flex flex-col h-full bg-black/90 rounded-[40px] border border-white/10 overflow-hidden ios-shadow">
                                        <header className="p-6 border-b border-white/10 flex items-center justify-between">
                                            <button onClick=${() => setPhoneApp(null)}><${Lucide.ChevronLeft} /></button>
                                            <span className="font-black uppercase text-xs tracking-widest">${phoneApp}</span>
                                            <div className="w-6" />
                                        </header>
                                        
                                        <div className="flex-1 overflow-y-auto p-6">
                                            ${phoneApp === 'ai' && html`
                                                <div className="flex flex-col h-full">
                                                    <div className="flex-1 space-y-4 mb-4 overflow-y-auto max-h-[400px] no-scrollbar">
                                                        <div className="bg-white/5 p-4 rounded-2xl border border-white/5">
                                                            <p className="text-xs opacity-50 mb-1">Chow AI</p>
                                                            <p className="text-sm">Hello ${state.name}! I am your personal neural link. How can I assist you today?</p>
                                                        </div>
                                                        ${aiResponse && html`
                                                            <div className="bg-blue-600/10 p-4 rounded-2xl border border-blue-600/20 ml-8 animate-in slide-in-from-right">
                                                                <p className="text-xs text-blue-400 mb-1">Chow AI Response</p>
                                                                <p className="text-sm">${aiResponse}</p>
                                                            </div>
                                                        `}
                                                    </div>
                                                    <div className="flex gap-2">
                                                        <input className="flex-1 bg-white/5 p-4 rounded-2xl text-sm" placeholder="Ask anything..." value=${aiQuery} onChange=${e => setAiQuery(e.target.value)} onKeyDown=${e => e.key === 'Enter' && askChowAi()} />
                                                        <button className="bg-blue-600 p-4 rounded-2xl active:scale-95" onClick=${askChowAi} disabled=${isAiLoading}>
                                                            <${Lucide.Send} size=${18} />
                                                        </button>
                                                    </div>
                                                </div>
                                            `}
                                            ${phoneApp === 'tok' && html`
                                                <div className="flex flex-col items-center gap-8 py-10">
                                                    <div className="w-32 h-32 rounded-full bg-gradient-to-br from-pink-500 to-yellow-500 p-1">
                                                        <div className="w-full h-full bg-black rounded-full flex items-center justify-center font-black text-2xl">C</div>
                                                    </div>
                                                    <div className="text-center">
                                                        <div className="text-3xl font-black">${state.chowtok.followers.toLocaleString()}</div>
                                                        <div className="text-[10px] font-bold opacity-40 uppercase">Followers</div>
                                                    </div>
                                                    <button className="w-full bg-white text-black font-black py-4 rounded-2xl active:scale-95" onClick=${() => setState(p => ({...p, chowtok: { ...p.chowtok, followers: p.chowtok.followers + 100 }}))}>POST CLIP (+100)</button>
                                                </div>
                                            `}
                                            ${phoneApp === 'store' && html`
                                                <div className="space-y-4">
                                                    <div className="flex items-center justify-between p-4 bg-white/5 rounded-2xl">
                                                        <div className="flex items-center gap-4">
                                                            <div className="w-12 h-12 bg-pink-500 rounded-xl" />
                                                            <div>
                                                                <div className="font-bold text-sm">ChowTok</div>
                                                                <div className="text-[10px] opacity-40">Social • Viral</div>
                                                            </div>
                                                        </div>
                                                        <button className="bg-white/10 px-4 py-1 rounded-full text-[10px] font-black uppercase">Open</button>
                                                    </div>
                                                    <div className="flex items-center justify-between p-4 bg-white/5 rounded-2xl">
                                                        <div className="flex items-center gap-4">
                                                            <div className="w-12 h-12 bg-indigo-500 rounded-xl" />
                                                            <div>
                                                                <div className="font-bold text-sm">Chow AI</div>
                                                                <div className="text-[10px] opacity-40">Intelligence • Help</div>
                                                            </div>
                                                        </div>
                                                        <button className="bg-white/10 px-4 py-1 rounded-full text-[10px] font-black uppercase">Open</button>
                                                    </div>
                                                </div>
                                            `}
                                            ${phoneApp === 'chat' && html`
                                                <div className="flex flex-col items-center justify-center py-20 opacity-30">
                                                    <${Lucide.MessagesSquare} size=${64} />
                                                    <p className="mt-4 font-bold">No recent chats.</p>
                                                </div>
                                            `}
                                        </div>
                                    </div>
                                `}
                            </div>
                        `}
                    </main>

                    <!-- Navigation Bar -->
                    <nav className="fixed bottom-0 left-0 right-0 glass pb-10 pt-4 px-6 z-50">
                        <div className="flex justify-between items-end max-w-md mx-auto">
                            <NavBtn icon=${Lucide.GraduationCap} label="Academy" active=${view === 'edu'} onClick=${() => setView('edu')} />
                            <NavBtn icon=${Lucide.Home} label="Home" active=${view === 'home'} onClick=${() => setView('home')} />
                            ${state.assets.phone && html`
                                <NavBtn icon=${Lucide.Smartphone} label="iPhone" active=${view === 'phone'} onClick=${() => { setView('phone'); setPhoneApp(null); }} />
                            `}
                            <NavBtn icon=${Lucide.ShoppingCart} label="Shop" active=${view === 'shop'} onClick=${() => setView('shop')} />
                            <NavBtn icon=${Lucide.User} label="Profile" active=${view === 'profile'} onClick=${() => setView('profile')} />
                        </div>
                    </nav>
                </div>
            `;
        }

        function NavBtn({ icon: Icon, label, active, onClick }) {
            return html`
                <button onClick=${onClick} className=${`flex flex-col items-center gap-1 transition-all ${active ? 'text-blue-500 scale-110' : 'opacity-40 hover:opacity-100'}`}>
                    <${Icon} size=${28} strokeWidth=${active ? 3 : 2} />
                    <span className="text-[8px] font-black uppercase tracking-tighter">${label}</span>
                </button>
            `;
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(html`<${App} />`);
    </script>
</body>
</html>




